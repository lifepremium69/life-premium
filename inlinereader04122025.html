<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Focus Line Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Smooth scrolling for the vertical shifts */
        #text-content {
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            will-change: transform;
        }
        
        /* Cursor blink effect for the current word */
        .current-word {
            background-color: rgba(255, 255, 255, 0.1);
            border-bottom: 2px solid #3b82f6;
        }

        /* Hide scrollbars for cleaner UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Custom slider styling for the dark theme */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -6px; 
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #4b5563;
            border-radius: 2px;
        }

        /* Keycap style for instructions */
        .kbd {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-bottom-width: 2px;
            border-radius: 0.25rem;
            padding-inline: 0.4em;
            padding-block: 0.1em;
            font-family: monospace;
            min-width: 1.5em;
            text-align: center;
            display: inline-block;
            box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-screen w-screen overflow-hidden font-sans flex flex-col">

    <!-- Top Control Bar -->
    <header class="flex-none bg-gray-800 border-b border-gray-700 p-3 md:p-4 z-40 shadow-lg">
        <div class="max-w-4xl mx-auto flex flex-wrap items-center justify-between gap-2">
            
            <div class="flex items-center gap-2 md:gap-4">
                <h1 class="text-lg md:text-xl font-bold text-blue-400 tracking-wider">FOCUS<span class="text-white">READER</span></h1>
            </div>

            <!-- Mode Toggle -->
            <div class="flex bg-gray-700 rounded-lg p-1">
                <button id="btn-edit" onclick="setMode('edit')" class="px-3 md:px-4 py-1 rounded-md text-xs md:text-sm font-medium transition-colors bg-blue-600 text-white">Edit</button>
                <button id="btn-read" onclick="setMode('read')" class="px-3 md:px-4 py-1 rounded-md text-xs md:text-sm font-medium transition-colors text-gray-400 hover:text-white">Read</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow relative overflow-hidden bg-gray-900">
        
        <!-- Editor View -->
        <div id="view-editor" class="absolute inset-0 p-4 md:p-8 max-w-4xl mx-auto w-full h-full flex flex-col z-20 bg-gray-900">
            <label class="text-sm text-gray-400 mb-2 font-medium">Paste your text here:</label>
            <textarea id="source-text" class="w-full flex-grow bg-gray-800 border border-gray-700 rounded-xl p-4 md:p-6 text-base md:text-lg text-gray-200 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none placeholder-gray-600 leading-relaxed shadow-inner" placeholder="Paste text here to begin reading...">In a futuristic city where neon lights never dimmed, a solitary coder named Alex sat hunched over a glowing terminal. The task was simple yet profound: create an interface that could read the human mind's pace of thought. As the lines of code cascaded down the screen, the rhythm of the typing synced with the heartbeat of the machine.

This application is designed to mimic that flow. It renders text dynamically, ensuring that your eyes never have to hunt for the next line. The active line stays perfectly centered, reducing eye strain and increasing reading speed. It is a technique often used by speed readers to maintain focus without the mechanical loss of time involved in saccadic eye movements. Try pasting a long article here and see how fast you can read comfortably.</textarea>
            <div class="mt-4 flex justify-end">
                <button onclick="setMode('read')" class="bg-blue-600 hover:bg-blue-500 text-white px-6 md:px-8 py-2 md:py-3 rounded-lg font-bold shadow-lg shadow-blue-900/20 transition-all hover:translate-y-[-2px] text-sm md:text-base">Start Reading &rarr;</button>
            </div>
        </div>

        <!-- Reader View -->
        <div id="view-reader" class="hidden absolute inset-0 w-full h-full overflow-hidden touch-none">
            <!-- 
                The Guide Line: A visual indicator of the center. 
            -->
            <div class="absolute top-1/2 left-0 w-full h-px bg-blue-500 opacity-20 pointer-events-none z-0 transform -translate-y-1/2"></div>
            
            <!-- Text Container -->
            <div id="text-wrapper" class="absolute top-0 left-0 w-full h-full flex justify-center pointer-events-none">
                <!-- Responsive text size: text-2xl on mobile, up to 4xl on desktop -->
                <div id="text-content" class="max-w-3xl px-4 md:px-8 text-2xl sm:text-3xl md:text-4xl leading-relaxed font-serif text-gray-400 transition-opacity duration-500 w-full text-center md:text-left">
                    <!-- Spans will be injected here -->
                </div>
            </div>
        </div>

    </main>

    <!-- Instructions Area (Bottom Left) - Hidden on mobile/tablet, Visible on lg (Desktop) -->
    <div id="instructions-area" class="hidden fixed bottom-8 left-8 z-40 text-gray-500 text-xs font-medium pointer-events-none select-none flex-col gap-2 opacity-70">
        <div class="flex items-center gap-2">
            <span class="kbd">Space</span> 
            <span>Play / Pause</span>
        </div>
        <div class="flex items-center gap-2">
            <span class="kbd">&larr;</span>
            <span class="kbd">&rarr;</span> 
            <span>Speed</span>
        </div>
        <div class="flex items-center gap-2">
            <span class="kbd">&uarr;</span>
            <span class="kbd">&darr;</span> 
            <span>Scroll (Paused)</span>
        </div>
    </div>

    <!-- 
        Floating Controls Area 
        Restructured: Full-width container at bottom, allowing separate positioning for Left (Mobile Reset) and Right (Desktop Stack).
    -->
    <div id="controls-area" class="hidden fixed inset-x-0 bottom-0 z-50 pointer-events-none">
        
        <!-- Mobile Reset Button (Bottom Left) - Visible only on mobile (< md) -->
        <button onclick="resetReader()" class="absolute bottom-4 left-4 pointer-events-auto md:hidden bg-gray-800 border border-gray-700 hover:bg-gray-700 text-gray-300 p-3 rounded-full shadow-lg transition-all active:scale-95">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        </button>

        <!-- Right Side Stack (Bottom Right) -->
        <div class="absolute bottom-4 right-4 md:bottom-8 md:right-8 flex flex-col items-center gap-3 md:gap-4 pointer-events-auto">
            
            <!-- Desktop Reset Button (Top of stack) - Visible only on desktop (>= md) -->
            <button onclick="resetReader()" class="hidden md:block bg-gray-800 border border-gray-700 hover:bg-gray-700 text-gray-300 p-2 md:p-3 rounded-full shadow-lg transition-all active:scale-95 group relative mb-1 md:mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                <!-- Tooltip -->
                <span class="hidden md:block absolute right-full mr-3 top-1/2 -translate-y-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">Reset</span>
            </button>

            <!-- Vertical Speed Slider -->
            <div class="bg-gray-800 border border-gray-700 py-2 md:py-3 px-2 rounded-2xl shadow-lg flex flex-col items-center gap-2 backdrop-blur-sm w-12 md:w-14">
                <span id="wpm-display" class="text-blue-400 font-mono text-[10px] md:text-xs font-bold">250</span>
                
                <div class="h-24 md:h-32 w-8 flex items-center justify-center relative my-1 md:my-2">
                    <input type="range" id="wpm-slider" min="60" max="800" value="250" step="10" 
                        class="absolute w-24 md:w-32 h-2 rounded-lg cursor-pointer -rotate-90 origin-center bg-gray-600 appearance-none">
                </div>
                
                <span class="text-[8px] md:text-[10px] text-gray-500 font-bold uppercase tracking-wider">WPM</span>
            </div>

            <!-- Play/Pause Button -->
            <button onclick="togglePlay()" id="btn-play" class="bg-blue-600 hover:bg-blue-500 text-white p-4 md:p-5 rounded-full shadow-xl shadow-blue-900/40 transition-all hover:scale-105 active:scale-95 flex items-center justify-center mt-1 md:mt-2">
                <!-- Icon is injected via JS -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 md:h-8 md:w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>

        </div>
    </div>

    <script>
        // State
        let words = [];
        let currentIndex = -1;
        let isPlaying = false;
        let timer = null;
        let wpm = 250;
        let scrollAccumulator = 0;
        
        // DOM Elements
        const viewEditor = document.getElementById('view-editor');
        const viewReader = document.getElementById('view-reader');
        const sourceText = document.getElementById('source-text');
        const textContent = document.getElementById('text-content');
        const textWrapper = document.getElementById('text-wrapper');
        const controlsArea = document.getElementById('controls-area');
        const instructionsArea = document.getElementById('instructions-area');
        const btnPlay = document.getElementById('btn-play');
        const wpmSlider = document.getElementById('wpm-slider');
        const wpmDisplay = document.getElementById('wpm-display');
        const btnEdit = document.getElementById('btn-edit');
        const btnRead = document.getElementById('btn-read');

        // --- Core Logic ---

        function setMode(mode) {
            pause();
            if (mode === 'edit') {
                viewEditor.classList.remove('hidden');
                viewReader.classList.add('hidden');
                controlsArea.classList.add('hidden');
                
                // HIDE instructions everywhere
                // We remove the desktop flex class. 'hidden' remains from HTML base class.
                instructionsArea.classList.remove('lg:flex');
                
                // Toggle Tab styles
                btnEdit.classList.add('bg-blue-600', 'text-white');
                btnEdit.classList.remove('text-gray-400');
                btnRead.classList.remove('bg-blue-600', 'text-white');
                btnRead.classList.add('text-gray-400');
            } else {
                prepareReader();
                viewEditor.classList.add('hidden');
                viewReader.classList.remove('hidden');
                controlsArea.classList.remove('hidden');
                
                // SHOW instructions ONLY on Desktop (lg and up)
                // Adds 'lg:flex' which overrides the base 'hidden' ONLY on large screens
                instructionsArea.classList.add('lg:flex');
                
                // Toggle Tab styles
                btnRead.classList.add('bg-blue-600', 'text-white');
                btnRead.classList.remove('text-gray-400');
                btnEdit.classList.remove('bg-blue-600', 'text-white');
                btnEdit.classList.add('text-gray-400');

                // Initial alignment
                requestAnimationFrame(() => {
                    centerOnWord(-1); 
                });
            }
        }

        function prepareReader() {
            const text = sourceText.value;
            const rawWords = text.trim().split(/\s+/).filter(w => w.length > 0);
            
            textContent.innerHTML = '';
            words = [];
            currentIndex = -1;

            rawWords.forEach((word, index) => {
                const span = document.createElement('span');
                span.textContent = word; 
                span.id = `word-${index}`;
                setWordStyleSpan(span, 'future');
                textContent.appendChild(span);
                words.push(span);
            });
        }

        function setWordStyleSpan(span, state) {
            const baseClasses = ['inline-block', 'transition-colors', 'duration-200', 'mr-[0.3em]'];
            span.className = ''; 
            span.classList.add(...baseClasses);

            if (state === 'future') {
                span.classList.add('opacity-10');
            } else if (state === 'current') {
                span.classList.add('text-white', 'current-word', 'opacity-100');
            } else if (state === 'read') {
                span.classList.add('opacity-50', 'text-gray-400');
            }
        }
        
        function setWordStyle(index, state) {
            if (index < 0 || index >= words.length) return;
            setWordStyleSpan(words[index], state);
        }

        function centerOnWord(index) {
            const targetIndex = index < 0 ? 0 : index;
            const targetWord = words[targetIndex];

            if (!targetWord) return;

            const containerHeight = viewReader.clientHeight;
            const wordOffsetTop = targetWord.offsetTop;
            const wordHeight = targetWord.offsetHeight;

            const targetY = (containerHeight / 2) - (wordOffsetTop + (wordHeight / 2));

            textContent.style.transform = `translateY(${targetY}px)`;
        }

        function nextStep() {
            if (currentIndex >= words.length - 1) {
                pause();
                return;
            }

            if (currentIndex >= 0) {
                setWordStyle(currentIndex, 'read');
            }

            currentIndex++;
            
            setWordStyle(currentIndex, 'current');
            centerOnWord(currentIndex);
        }

        function stepManual(direction) {
            if (direction === 1) {
                if (currentIndex < words.length - 1) {
                    if (currentIndex >= 0) setWordStyle(currentIndex, 'read');
                    currentIndex++;
                    setWordStyle(currentIndex, 'current');
                    centerOnWord(currentIndex);
                }
            } else {
                if (currentIndex > -1) {
                    setWordStyle(currentIndex, 'future');
                    currentIndex--;
                    if (currentIndex >= 0) {
                        setWordStyle(currentIndex, 'current');
                    }
                    centerOnWord(currentIndex);
                }
            }
        }

        function togglePlay() {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        }

        function play() {
            if (currentIndex >= words.length - 1) {
                resetReader(); 
            }
            isPlaying = true;
            updatePlayButton();
            
            const interval = 60000 / wpm;
            if (currentIndex === -1) nextStep();
            
            timer = setInterval(nextStep, interval);
        }

        function pause() {
            isPlaying = false;
            clearInterval(timer);
            updatePlayButton();
        }

        function resetReader() {
            pause();
            words.forEach(w => setWordStyleSpan(w, 'future'));
            currentIndex = -1;
            requestAnimationFrame(() => centerOnWord(-1));
        }

        function updatePlayButton() {
            const iconSize = window.innerWidth < 768 ? "h-6 w-6" : "h-8 w-8";
            if (isPlaying) {
                btnPlay.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="${iconSize}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                `;
                btnPlay.classList.add('bg-red-500', 'hover:bg-red-600');
                btnPlay.classList.remove('bg-blue-600', 'hover:bg-blue-500');
            } else {
                btnPlay.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="${iconSize}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                `;
                btnPlay.classList.remove('bg-red-500', 'hover:bg-red-600');
                btnPlay.classList.add('bg-blue-600', 'hover:bg-blue-500');
            }
        }

        // --- Event Listeners ---

        function updateSpeed(newWpm) {
            wpm = Math.min(Math.max(parseInt(newWpm), 60), 800);
            wpmDisplay.textContent = wpm;
            wpmSlider.value = wpm;
            
            if (isPlaying) {
                clearInterval(timer);
                const interval = 60000 / wpm;
                timer = setInterval(nextStep, interval);
            }
        }

        wpmSlider.addEventListener('input', (e) => updateSpeed(e.target.value));

        wpmSlider.addEventListener('wheel', (e) => {
            e.preventDefault(); 
            const direction = e.deltaY < 0 ? 1 : -1;
            updateSpeed(wpm + (direction * 20));
        });

        // Mouse Wheel Scroll (Desktop)
        window.addEventListener('wheel', (e) => {
            if (isPlaying || viewReader.classList.contains('hidden')) return;
            if (e.target === wpmSlider) return; 

            scrollAccumulator += e.deltaY;
            const threshold = 30; 

            if (scrollAccumulator > threshold) {
                stepManual(1);
                scrollAccumulator = 0;
            } else if (scrollAccumulator < -threshold) {
                stepManual(-1);
                scrollAccumulator = 0;
            }
        }, { passive: false });

        // --- Touch Gestures for Mobile Scrolling ---
        let touchStartY = 0;

        window.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        }, { passive: false });

        window.addEventListener('touchmove', (e) => {
            if (isPlaying || viewReader.classList.contains('hidden')) return;
            if (e.target.closest('#controls-area')) return; 

            const touchCurrentY = e.touches[0].clientY;
            const diff = touchStartY - touchCurrentY; 
            
            if (Math.abs(diff) > 15) {
                if (diff > 0) {
                    stepManual(1);
                } else {
                    stepManual(-1);
                }
                touchStartY = touchCurrentY; 
            }
        }, { passive: false });

        // --- Keyboard Controls ---
        window.addEventListener('keydown', (e) => {
            // Only active if we are in READER mode (Editor is hidden)
            if (!viewReader || viewReader.classList.contains('hidden')) return;

            switch(e.code) {
                case 'Space':
                    e.preventDefault(); // Stop page scrolling on Space
                    togglePlay();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    updateSpeed(wpm + 10);
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    updateSpeed(wpm - 10);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    // Scroll Back (Rewind) only when paused
                    if (!isPlaying) stepManual(-1);
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    // Scroll Forward only when paused
                    if (!isPlaying) stepManual(1);
                    break;
            }
        });

        // Resize handler
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if(viewReader.classList.contains('hidden')) return;
                centerOnWord(currentIndex);
                updatePlayButton();
            }, 100);
        });

    </script>
</body>
</html>
